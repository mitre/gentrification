---
title: "Geography Explore"
output: html_document
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(tigris_use_cache = TRUE)

library(tigris)
library(sp)
library(sf)
library(tidyverse)
library(tmap)
library(shiny)
```

## Objective

-   Determine what boundaries to use when identifying reference areas for Gentrification

[https://www.census.gov/geographies/mapping-files/time-series/geo/ORrtographic-boundary.html](https://www.census.gov/geographies/mapping-files/time-series/geo/cartographic-boundary.html){.uri}

-   Examined boundaries:

    -   Counties - currently used reference area
    -   Consolidated Cities (ConCity)
    -   Core Based Statistical Areas (CBSA)
    -   Combined Statistical Areas (CSA)
    -   Metropolitan Divisions (MetDiv)
    -   Places

## Redlining & Places Geo Boundaries

[Ch9GARM.pdf (census.gov)](https://www2.census.gov/geo/pdfs/reference/GARM/Ch9GARM.pdf)

The Bureau of the Census defines a place as a concentration of population; a place may or may not have legally prescribed limits, powers, or functions. This concentration of population must have a name, be locally recognized, and not be part of any other place.

[Legal/Statistical Area Description (LSAD) Codes (census.gov)](https://www2.census.gov/geo/pdfs/reference/LSADCodes.pdf)

```{r}

places <- readRDS("../outputs/geo_places.RDS")
tracts <- readRDS("../outputs/geo_tracts.RDS")
holc <- read.csv("../raw data/All_Population_Weighted_HOLC_Grades_pt2_Threshold.csv") %>%
  mutate(GEOID = as.character(GEOID))
lsad <- readxl::read_xlsx("../raw data/LSAD_crosswalk.xlsx", n_max = 15)

holc_tracts <- merge(tracts, holc, by = "GEOID")
places <- left_join(places, lsad, by = "LSAD")

table(places$`LSAD Description`)
```

-   City (suffix)

-   County (suffix)

```{r, echo = FALSE}

selectInput(inputId = "state",
            label = "Choose State",
            choices = unique(holc_tracts$state))

renderUI({
  cities <- unique(holc[holc$state == input$state, "city"])
  selectInput(inputId = "city",
              label = "Select Redlined City",
              choices = cities)
})


renderTmap({

state_num <- holc_tracts[holc_tracts$state == input$state,]$STATEFP
  
  tm_shape(name = "HOLC",
           holc_tracts %>%
             filter(city == input$city)) +
    tm_polygons(col = "holc_grade_pop",
                alpha = 0.7) +
    
    tm_shape(name = "LSAD Cities",
             places %>%
               filter(`LSAD Description` == "City (suffix)",
                      STATEFP == state_num)) +
    tm_borders(col ="#08589e", lwd = 1.5) +
    tm_text(text = "NAME") +
    
    tm_shape(name = "LSAD Towns",
             places %>%
               filter(`LSAD Description` == "Town (suffix)",
                      STATEFP == state_num)) +
    tm_borders(col = "#4eb3d3", lwd = 1.5) +
    tm_text(text = "NAME") +
    
       tm_shape(name = "LSAD CDP",
             places %>%
               filter(`LSAD Description` == "CDP (suffix)",
                      STATEFP == state_num)) +
    tm_borders(col = "#a8ddb5", lwd = 1.5) +
    tm_text(text = "NAME")
})

```
